<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.coffeereview.mapper.MenuMapper">

<select id="getMenuList" resultType="com.coffeereview.domain.MenuVO">

	<![CDATA[
		select 
			* 
		from 
			tbl_menu 
		where 
			cafe = #{cafe}
	]]>
	
</select>

<select id="getMenu" resultType="com.coffeereview.domain.MenuVO">

	select 
		* 
	from 
		tbl_menu 
	where 
		mno = #{mno}
		
</select>

<sql id="criteria">
	<trim suffix="AND">
		<if test='keyword != null and keyword neq ""'>
			menu like CONCAT('%',#{keyword},'%')
		</if>
	</trim>
	<trim suffix="AND">
		<if test='cafe != null and cafe neq ""'>
			cafe = #{cafe}
		</if>
	</trim>
</sql>

<select id="getMenuListWithPaging" resultType="com.coffeereview.domain.MenuVO">

	<![CDATA[
		SELECT
			@rownum:=@rownum+1 as no, 
			mno, menu, cafe, star_avg
		FROM 
			tbl_menu
		WHERE
	]]>
	
	<include refid="criteria"></include>
	
	<![CDATA[
			mno > 0
		LIMIT
			#{pageStart}, #{amount};
	]]>
	
</select>

<select id="getTotalCount" resultType="int">
	select 
		count(*) 
	from 
		tbl_menu 
	where 
		
		<include refid="criteria"></include>
	
		mno > 0
</select>

</mapper>